
<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>益福汽車管理系統｜自動登入示範</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <div class="card" style="max-width:760px">
    <div class="header">
      <div class="h1">益福汽車管理系統</div>
      <a href="index.html" class="badge">返回入口</a>
    </div>
    <div class="body" style="grid-template-columns:1fr">
      <div class="panel">
        <h2>自動登入結果</h2>
        <div id="result" class="notice">檢查中…</div>
        <hr/>
        <div class="row">
          <button id="btnLogout" class="btn">登出</button>
          <a href="salary.html" class="btn btn-green">前往薪資計算（需管理員）</a>
        </div>
      </div>
    </div>
  </div>
  <script src="auth.js"></script>
  <script>
    async function main(){
      const cur = await Auth.getCurrent();
      const box = document.getElementById('result');
      if(!cur.ok){
        box.innerHTML = '<span class="error">尚未登入，已導回入口頁。</span>';
        setTimeout(()=>location.href='index.html', 800);
        return;
      }
      const v = await Auth.verifyToken(cur.token);
      if(!v.ok){
        box.innerHTML = '<span class="error">Token 無效或逾時，請重新登入。</span>';
        setTimeout(()=>location.href='index.html', 1000);
        return;
      }
      box.innerHTML = `<div class="success">已自動登入：<b>${cur.role==='admin'?'管理員':'一般使用者'}</b></div>
      <div class="notice">（示範）此頁面視為已完成自動登入，後續即可顯示管理系統內容。</div>`;
    }
    document.getElementById('btnLogout').addEventListener('click', ()=>{ Auth.logout(); location.href='index.html'; });
    main();
  </script>
</body>
</html>
